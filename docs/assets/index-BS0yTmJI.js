import{j as e,R as ue,r as h}from"./react-BkCFb41Y.js";import{a as $e}from"./react-dom-BcT_u2RR.js";import{c as U}from"./zustand-DLhad_yI.js";import{B as L,S as Pe,a as Te,b as Le,P as Fe,T as O,L as X,c as V,d as Y,D as Re,e as $,I as W,C as Be,f as ee,E as Ue,H as Me,g as Ke,h as ze,i as F,u as H,j as me,k as ge,l as xe,m as He,n as pe,s as _e,o as Ge}from"./@mui-B2ni9Bkb.js";import{u as he,B as We}from"./react-router-dom-B_2WF8qC.js";import{u as te,a as Je,Q as Qe,M as qe,b as Ze,c as Xe}from"./@tanstack-DpQXpXmE.js";import{S as M}from"./@radix-ui-B08lzGHt.js";import{c as fe}from"./class-variance-authority-Dp3B9jqt.js";import{c as Ve}from"./clsx-B-dksMZM.js";import{t as Ye}from"./tailwind-merge-BZSatpsL.js";import{u as et,a as ne,b as se,D as tt,S as be,r as nt,c as st,d as ot,e as rt,s as it,K as at,P as lt,f as ve,C as je,v as ct}from"./@dnd-kit-Le8HzPvy.js";import{a as dt}from"./axios-Dnk_-Q5K.js";import{G as ut}from"./lucide-react-zY-0ZsVT.js";import{Q as mt}from"./react-qr-code-CT-U_cMh.js";import{$ as oe}from"./peerjs-DxFR7Coi.js";import{u as J,a as ye,b as gt}from"./jotai-B-Mb4bjH.js";import{b as Ce,c as T,a as Q,d as De,u as xt}from"./react-router-DpoJgAuD.js";import{v as we}from"./uuid-C6aID195.js";import"./@babel-B_fy3T9z.js";import"./scheduler-C323NY8X.js";import"./react-transition-group-CEW9j9Fk.js";import"./@emotion-DgS3u6Nu.js";import"./hoist-non-react-statics-C-Qo8PK8.js";import"./stylis-DDa9OTMq.js";import"./@popperjs-CMBiYTiD.js";import"./@remix-run-tn2ilB4G.js";import"./prop-types-Chjiymov.js";import"./qr.js-D7uXRtkb.js";import"./peerjs-js-binarypack-0qb93TeF.js";import"./webrtc-adapter-DzGuYBkV.js";import"./sdp-C8-99_ry.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const i of d.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerPolicy&&(d.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?d.credentials="include":r.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(r){if(r.ep)return;r.ep=!0;const d=n(r);fetch(r.href,d)}})();const K=t=>(o,n,l)=>t((...r)=>{console.log("  applying",r),o(...r),console.log("  new state",n())},n,l),re={open:!1,message:null,anchorOrigin:{vertical:"top",horizontal:"center"},autoHideDuration:3e3,status:null},G=U(K((t,o)=>({...re,setSnackMsg:n=>t({...n,open:!0}),closeSnackbar:()=>t(re)})));function pt(t){return e.jsx(Le,{...t,direction:"down"})}function ht(t){const{snackbar:o,closeSnackbar:n,message:l,open:r,anchorOrigin:d,autoHideDuration:i,status:s}=G(v=>v),u=e.jsx(ue.Fragment,{children:e.jsx(L,{color:"inherit",size:"small",onClick:n,children:"ç¢ºèª"})}),c=v=>{switch(v){case 401:return"æ²’æœ‰æ¬Šé™ï¼";case 500:return"APIç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼"}};return e.jsx(Pe,{open:r,onClose:n,anchorOrigin:d,TransitionComponent:pt,autoHideDuration:i,children:e.jsx("div",{className:"rainbow",children:e.jsx("div",{className:"rainbow-container",children:e.jsx(Te,{message:s!=null?c(s):l,action:u})})})})}const ft="",bt={apiurl:ft},vt={mid:null,name:"è¨ªå®¢",account:null,email:null,sso:null,lastLoginDT:null,isLogin:null,refetch:null};U(K((t,o)=>({...vt,setAccount:n=>t({...n,isLogin:!((n==null?void 0:n.mid)==0||!(n!=null&&n.mid))})})));const ie={open:!1,title:"",content:"",handleAgree:()=>{},handleDisagree:()=>{}},jt=U(K((t,o)=>({...ie,setAlert:n=>t({...ie,...n,open:!0}),closeAlert:()=>t({open:!1})}))),yt={isSidebarOpen:!0},Ct=U(K((t,o)=>({...yt,setSidebarOpen:(n=null)=>t(l=>({isSidebarOpen:n!==null?n:!l.isSidebarOpen}))}))),ae={open:!1,title:"",content:null,actions:null,body:null},Dt=U(K((t,o)=>({...ae,setDialog:n=>t({...ae,...n,open:!0}),closeDialog:()=>t({open:!1})})));function k(...t){return Ye(Ve(t))}const wt=fe("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/70",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ie({className:t,variant:o,asChild:n=!1,...l}){const r=n?M:"span";return e.jsx(r,{"data-slot":"badge",className:k(wt({variant:o}),t),...l})}const It=fe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"text-destructive hover-text-foreground bg-secondary border border-border hover:text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:hover:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function St({className:t,variant:o,size:n,asChild:l=!1,...r}){const d=l?M:"button";return e.jsx(d,{"data-slot":"button",className:k(It({variant:o,size:n,className:t})),...r})}const R=h.createContext({columns:{},setColumns:()=>{},getItemId:()=>"",columnIds:[],activeId:null,setActiveId:()=>{},findContainer:()=>{},isColumn:()=>!1}),Se=h.createContext({attributes:{},listeners:void 0,isDragging:!1,disabled:!1}),Ne=h.createContext({listeners:void 0,isDragging:!1,disabled:!1}),Nt={...rt,sideEffects:ot({styles:{active:{opacity:"0.4"}}})};function Et({value:t,onValueChange:o,getItemValue:n,children:l,className:r,onMove:d}){const i=t,s=o,[u,c]=h.useState(null),v=et(ne(lt,{activationConstraint:{distance:10}}),ne(at,{coordinateGetter:it})),f=h.useMemo(()=>Object.keys(i),[i]),x=h.useCallback(N=>f.includes(N),[f]),b=h.useCallback(N=>x(N)?N:f.find(I=>i[I].some(a=>n(a)===N)),[i,f,n,x]),y=h.useCallback(N=>{c(N.active.id)},[]),D=h.useCallback(N=>{if(d)return;const{active:I,over:a}=N;if(!a||x(I.id))return;const p=b(I.id),m=b(a.id);if(!p||!m||p===m)return;const g=i[p],j=i[m],w=g.findIndex(B=>n(B)===I.id);let C=j.findIndex(B=>n(B)===a.id);x(a.id)&&(C=j.length);const E=[...j],[z]=g.splice(w,1);E.splice(C,0,z),s({...i,[p]:[...g],[m]:E})},[b,n,x,s,i,d]),A=h.useCallback(N=>{const{active:I,over:a}=N;if(c(null),!a)return;if(d&&!x(I.id)){const g=b(I.id),j=b(a.id);if(g&&j){const w=i[g].findIndex(E=>n(E)===I.id),C=x(a.id)?i[j].length:i[j].findIndex(E=>n(E)===a.id);d({event:N,activeContainer:g,activeIndex:w,overContainer:j,overIndex:C})}return}if(x(I.id)&&x(a.id)){const g=f.indexOf(I.id),j=f.indexOf(a.id);if(g!==j){const w=se(Object.keys(i),g,j),C={};w.forEach(E=>{C[E]=i[E]}),s(C)}return}const p=b(I.id),m=b(a.id);if(p&&m&&p===m){const g=p,j=i[g].findIndex(C=>n(C)===I.id),w=i[g].findIndex(C=>n(C)===a.id);j!==w&&s({...i,[g]:se(i[g],j,w)})}},[f,i,b,n,x,s,d]),P=h.useMemo(()=>({columns:i,setColumns:s,getItemId:n,columnIds:f,activeId:u,setActiveId:c,findContainer:b,isColumn:x}),[i,s,n,f,u,b,x]);return e.jsx(R.Provider,{value:P,children:e.jsx(tt,{sensors:v,onDragStart:y,onDragOver:D,onDragEnd:A,children:e.jsx("div",{"data-slot":"kanban","data-dragging":u!==null,className:k(r),children:l})})})}function At({children:t,className:o}){const{columnIds:n}=h.useContext(R);return e.jsx(be,{items:n,strategy:nt,children:e.jsx("div",{"data-slot":"kanban-board",className:k("grid auto-rows-fr sm:grid-cols-3 gap-4",o),children:t})})}function kt({value:t,className:o,children:n,disabled:l}){const{setNodeRef:r,transform:d,transition:i,attributes:s,listeners:u,isDragging:c}=ve({id:t,disabled:l}),{activeId:v,isColumn:f}=h.useContext(R),x=v?f(v):!1,b={transition:i,transform:je.Translate.toString(d)};return e.jsx(Se.Provider,{value:{attributes:s,listeners:u,isDragging:x,disabled:l},children:e.jsx("div",{"data-slot":"kanban-column","data-value":t,"data-dragging":c,"data-disabled":l,ref:r,style:b,className:k("group/kanban-column flex flex-col",c&&"opacity-50",l&&"opacity-50",o),children:n})})}function Ot({asChild:t,className:o,children:n,cursor:l=!0}){const{attributes:r,listeners:d,isDragging:i,disabled:s}=h.useContext(Se),u=t?M:"div";return e.jsx(u,{"data-slot":"kanban-column-handle","data-dragging":i,"data-disabled":s,...r,...d,className:k("opacity-0 transition-opacity group-hover/kanban-column:opacity-100",l&&(i?"!cursor-grabbing":"!cursor-grab"),o),children:n})}function $t({value:t,asChild:o=!1,className:n,children:l,disabled:r}){const{setNodeRef:d,transform:i,transition:s,attributes:u,listeners:c,isDragging:v}=ve({id:t,disabled:r}),{activeId:f,isColumn:x}=h.useContext(R),b=f?!x(f):!1,y={transition:s,transform:je.Translate.toString(i)},D=o?M:"div";return e.jsx(Ne.Provider,{value:{listeners:c,isDragging:b,disabled:r},children:e.jsx(D,{"data-slot":"kanban-item","data-value":t,"data-dragging":v,"data-disabled":r,ref:d,style:y,...u,className:k(v&&"opacity-50",r&&"opacity-50",n),children:l})})}function Pt({asChild:t,className:o,children:n,cursor:l=!0}){const{listeners:r,isDragging:d,disabled:i}=h.useContext(Ne),s=t?M:"div";return e.jsx(s,{"data-slot":"kanban-item-handle","data-dragging":d,"data-disabled":i,...r,className:k(l&&(d?"!cursor-grabbing":"!cursor-grab"),o),children:n})}function Tt({value:t,className:o,children:n}){const{columns:l,getItemId:r}=h.useContext(R),d=h.useMemo(()=>l[t].map(r),[l,r,t]);return e.jsx(be,{items:d,strategy:ct,children:e.jsx("div",{"data-slot":"kanban-column-content",className:k("flex flex-col gap-2",o),children:n})})}function Lt({children:t,className:o}){const{activeId:n,isColumn:l}=h.useContext(R),[r,d]=h.useState(null);h.useEffect(()=>{if(n){const u=document.querySelector(`[data-slot="kanban-${l(n)?"column":"item"}"][data-value="${n}"]`);if(u){const c=u.getBoundingClientRect();d({width:c.width,height:c.height})}}else d(null)},[n]);const i={width:r==null?void 0:r.width,height:r==null?void 0:r.height},s=h.useMemo(()=>n?typeof t=="function"?t({value:n,variant:l(n)?"column":"item"}):t:null,[n,t,l]);return e.jsx(st,{dropAnimation:Nt,children:e.jsx("div",{"data-slot":"kanban-overlay","data-dragging":!0,style:i,className:k("pointer-events-none",o,n?"!cursor-grabbing":""),children:s})})}const{apiurl:Ft}=bt;function q({cmd:t,cmd_url:o=null,method:n="GET",type:l="json",data:r={},header:d={},fileList:i=[],fileObj:s={}}){var v,f;n=n.toUpperCase(),l=l.toLowerCase();let u=o??`${Ft}/${t}`,c={method:n,headers:{"Content-Type":"application/json",...d}};if(i.length||((v=Object.keys(s))==null?void 0:v.length)>0){let x=new FormData;c.headers["Content-Type"]="multipart/form-data",[...i].forEach(y=>{x.append("files",y)}),(f=Object.keys(s))==null||f.map(y=>{Array.isArray(s[y])?[...s[y]].forEach(A=>{x.append(y,A)}):x.append(y,s[y])}),Object.keys(r).map(y=>{x.append(y,r[y])}),r=x}switch(n){case"POST":case"PUT":case"DELETE":c.data=r;break;case"GET":c.params=r;break}return dt({method:n,url:u,...c,withCredentials:!1}).then(x=>({ok:x.status=="200"||x.status=="403",status:x.status,body:x.data})).catch(x=>{let b=x.response;if(b)return{ok:b.status=="200",status:b.status,body:b.data};throw new Error({ok:!1,status:404,body:x.message})})}const Rt=async()=>await q({method:"GET",cmd_url:"https://sheets.googleapis.com/v4/spreadsheets/1ehRPqqtjiyiZeCXwOqalwgaMIFyE8kL2At4rUKp36Ug/values/kanban!A:G?alt=json&key=AIzaSyDPwaw0jfTbUMM1qrdEwB4ZUivo8dBdEbA"}),Bt=async()=>await q({method:"GET",cmd_url:"https://sheets.googleapis.com/v4/spreadsheets/1ehRPqqtjiyiZeCXwOqalwgaMIFyE8kL2At4rUKp36Ug/values/columns!A:B?alt=json&key=AIzaSyDPwaw0jfTbUMM1qrdEwB4ZUivo8dBdEbA"}),Ut=async({list:t=[]})=>await q({method:"POST",cmd_url:`https://script.google.com/macros/s/${localStorage.getItem("sheet")}/exec`,data:{list:t},header:{"Content-Type":"text/plain;charset=utf-8"}}),Mt=t=>t.map(o=>({id:o[0],title:o[1],jiraId:o[2],des:o[3],task:o[4],priority:o[5],assignee:o[6]}));function Kt(){var r,d;const t=te({queryKey:["getGoogleSheetIssue"],queryFn:()=>Rt()}),o=te({queryKey:["getGoogleSheetTask"],queryFn:()=>Bt()}),n=Mt(((r=t==null?void 0:t.data)==null?void 0:r.values)||[]),l=((d=o==null?void 0:o.data)==null?void 0:d.values)||[];return e.jsx("div",{className:"p-4 grid h-screen grid-rows-[var(--header-height)_1fr_6rem] overflow-x-hidden sm:grid-rows-[var(--header-height)_1fr_var(--header-height)]",children:e.jsx(zt,{tasks:l,issues:n})})}function Ee({task:t,asHandle:o,...n}){const l=e.jsx("div",{className:"rounded-md border bg-card p-3 shadow-xs",children:e.jsxs("div",{className:"flex flex-col gap-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"line-clamp-1 font-medium text-sm",children:t.title}),e.jsx(Ie,{variant:t.priority==="high"?"destructive":t.priority==="medium"?"primary":"warning",appearance:"outline",className:"pointer-events-none h-5 rounded-sm px-1.5 text-[11px] capitalize shrink-0",children:t.priority})]}),e.jsxs("div",{className:"flex items-center justify-between text-muted-foreground text-xs",children:[t.jiraId&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:"line-clamp-1",children:t.jiraId})}),t.assignee&&e.jsx("time",{className:"text-[10px] tabular-nums whitespace-nowrap",children:t.assignee})]})]})});return e.jsx($t,{value:t.id,...n,children:o?e.jsx(Pt,{children:l}):l})}function le({value:t,tasks:o,isOverlay:n,...l}){return e.jsxs(kt,{value:t,...l,className:"rounded-md border bg-card p-2.5 shadow-xs",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("span",{className:"font-semibold text-sm",children:t}),e.jsx(Ie,{variant:"secondary",children:o.length})]}),e.jsx(Ot,{asChild:!0,children:e.jsx(St,{variant:"dim",size:"sm",mode:"icon",children:e.jsx(ut,{})})})]}),e.jsx(Tt,{value:t,className:"flex flex-col gap-2.5 p-0.5",children:o.map(r=>e.jsx(Ee,{task:r,asHandle:!n},r.id))})]})}function zt({tasks:t,issues:o}){const[n,l]=ue.useState({}),r=Je({mutationFn:Ut});h.useEffect(()=>{if(Array.isArray(o)&&Array.isArray(t)){let i={};t==null||t.map(s=>{let u=s[0];i[u]=o==null?void 0:o.filter(c=>c.task==u)}),l(i)}},[o,t]);const d=i=>{var u;let s=[];(u=Object.keys(i))==null||u.map(c=>{let v=i[c];s=s.concat(v)}),r.mutate({list:s},{onSuccess:c=>console.log(c)}),l(i)};return e.jsxs(Et,{value:n,onValueChange:d,getItemValue:i=>i.id,children:[e.jsx(At,{className:"grid auto-rows-fr grid-cols-3",children:Object.entries(n).map(([i,s])=>e.jsx(le,{value:i,tasks:s},i))}),e.jsx(Lt,{children:({value:i,variant:s})=>{if(s==="column"){const c=n[i]||[];return e.jsx(le,{value:i,tasks:c,isOverlay:!0})}const u=Object.values(n).flat().find(c=>c.id===i);return u?e.jsx(Ee,{task:u}):null}})]})}const S={SELECTED:"selected",SENDING:"sending",SENT:"sent",FAILED:"failed",RECEIVED:"received",DOWNLOADED:"downloaded"},Ae=ye(!1);function Ht({roomId:t,isHost:o}){const[n,l]=h.useState(null),[r,d]=J(Ae),i=h.useRef(null),[s,u]=h.useState([]),[c,v]=h.useState([]),f=h.useRef({}),{setSnackMsg:x}=G();h.useEffect(()=>{let a;if(t)return o?(a=new oe(t),console.log(`Host attempting to open Peer with ID: ${t}`)):(a=new oe(void 0),console.log("Joiner attempting to open Peer with a random ID")),l(a),()=>{a&&!(a!=null&&a.destroyed)&&(console.log("Destroying peer instance:",a.id),a.destroy()),l(null),u([]),v([])}},[t,o]),h.useEffect(()=>{if(!n)return;n.removeAllListeners();const a=m=>console.error("PeerJS error:",m);n.on("error",a);const p=m=>{i.current=m,m.on("open",()=>{d(!0),console.log(`DataConnection open with ${m.peer}`)}),m.on("close",()=>{d(!1),i.current=null,console.log(`DataConnection closed with ${m.peer}`)}),m.on("error",g=>{console.error(`DataConnection error with ${m.peer}:`,g),d(!1)}),m.on("data",g=>{if(o)g.type==="file-received-ack"?(console.log(`Host: ACK for file ${g.fileId}`),u(j=>j.map(w=>w.id===g.fileId?{...w,status:S.SENT}:w))):g.type==="file-receive-error"&&(console.error(`Host: Joiner reported error for file ${g.fileId}: ${g.error}`),u(j=>j.map(w=>w.id===g.fileId?{...w,status:S.FAILED}:w)));else if(console.log("blob in",g),g.type==="file-metadata")console.log("Joiner: Received file metadata",g),f.current[g.fileId]=g;else if(g instanceof Blob||g instanceof ArrayBuffer||g instanceof Uint8Array){let j=null;const w=Object.keys(f.current).filter(C=>!c.some(E=>E.id===C));if(w.length>0){const C=w[w.length-1];C&&f.current[C]&&(j=f.current[C])}if(j){const{fileId:C,name:E,mimeType:z,size:B}=j;console.log(`Joiner: Received blob for ${E} (ID: ${C})`);const Z=g instanceof Blob?g:new Blob([g],{type:z}),ke=URL.createObjectURL(Z);v(Oe=>[...Oe,{id:C,name:E,type:z,size:B,blobUrl:ke,blobObject:Z,status:S.RECEIVED}]),m.send({type:"file-received-ack",fileId:C}),delete f.current[C]}else console.warn("Joiner: Received blob/arraybuffer without matching metadata or ID.")}else g.type==="batch-meta"&&console.log("Joiner: Received batch metadata",g)})};o?(n.on("open",m=>console.log(`Host Peer opened: ${m}`)),n.on("connection",p)):n.on("open",m=>{if(console.log(`Joiner Peer opened: ${m}`),t){const g=n.connect(t);p(g)}})},[n,t,o,c]);const b=a=>{const p=Array.from(a.target.files).map(m=>({id:we(),name:m.name,size:m.size,type:m.type,previewUrl:URL.createObjectURL(m),status:S.SELECTED,fileObject:m}));u(m=>[...m,...p]),a.target.value=null},y=async()=>{if(!r||!i.current){alert("é€£ç·šæœªå»ºç«‹!");return}const a=s.filter(p=>p.status===S.SELECTED);if(a.length===0){alert("æ²’æœ‰å·²é¸æ“‡çš„æª”æ¡ˆå¯å‚³é€ã€‚");return}i.current.send({type:"batch-meta",totalFiles:a.length});for(const p of a){u(m=>m.map(g=>g.id===p.id?{...g,status:S.SENDING}:g));try{const m={type:"file-metadata",fileId:p.id,name:p.name,mimeType:p.type,size:p.size};i.current.send(m)}catch(m){console.error(`Host: Error sending file ${p.name}:`,m),u(g=>g.map(j=>j.id===p.id?{...j,status:S.FAILED}:j))}}for(const p of a)try{await new Promise(m=>setTimeout(m,50)),i.current.send(p.fileObject),console.log(`Host: Sent ${p.name} (ID: ${p.id})`)}catch(m){console.error(`Host: Error sending file ${p.name}:`,m),u(g=>g.map(j=>j.id===p.id?{...j,status:S.FAILED}:j))}},D=a=>{const p=c.find(m=>m.id===a);if(p){const m=document.createElement("a");m.href=p.blobUrl,m.download=p.name,document.body.appendChild(m),m.click(),document.body.removeChild(m),v(g=>g.map(j=>j.id===a?{...j,status:S.DOWNLOADED}:j))}},A=async()=>{const a=c.filter(p=>p.status===S.RECEIVED&&p.blobUrl);if(a.length===0){x({message:"æ²’æœ‰å¯ä¸‹è¼‰çš„æ–°æª”æ¡ˆã€‚"});return}for(let p=0;p<a.length;p++){const m=a[p];console.log(`Auto-downloading ${p+1}/${a.length}: ${m.name}`),D(m.id),p<a.length-1&&await new Promise(g=>setTimeout(g,500))}x({message:`${a.length} å€‹æª”æ¡ˆå·²é–‹å§‹ä¸‹è¼‰ã€‚`})},P=c.some(a=>a.status===S.RECEIVED&&a.blobUrl),N=a=>{const p=s.filter(m=>m.id!==a);u(p)},I=(a,p=null)=>{switch(a){case S.SELECTED:return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"å·²é¸æ“‡",children:e.jsx(Ke,{color:"action"})}),e.jsx($,{title:"åˆªé™¤",children:e.jsx(W,{sx:{ml:1},onClick:()=>N(p),children:e.jsx(ze,{color:"action"})})})]});case S.SENDING:return e.jsx($,{title:"å‚³é€ä¸­",children:e.jsx(Me,{color:"primary",className:"animate-spin"})});case S.SENT:return e.jsx($,{title:"å·²å‚³é€",children:e.jsx(ee,{color:"success"})});case S.FAILED:return e.jsx($,{title:"å¤±æ•—",children:e.jsx(Ue,{color:"error"})});default:return null}};return e.jsx("div",{children:e.jsx(Ce,{children:e.jsx(T,{path:"/transfer",element:e.jsxs(Fe,{elevation:3,className:"p-4 md:p-6 max-w-2xl mx-auto my-4",children:[e.jsxs(O,{variant:"h5",component:"h2",gutterBottom:!0,className:"text-center text-indigo-600",children:["WHL's æª”æ¡ˆå‚³è¼¸ (",o?"Host":"Joiner",")"]}),e.jsxs("div",{className:"mb-4 space-y-2",children:[e.jsxs(O,{children:["Peer ID: ",e.jsx("span",{className:"font-mono bg-gray-100 p-1 rounded",children:(n==null?void 0:n.id)||"..."})]}),o&&e.jsxs(O,{children:["æˆ¿è™Ÿ: ",e.jsx("span",{className:"font-mono bg-gray-100 p-1 rounded",children:t})]}),e.jsxs(O,{children:["é€£ç·šç‹€æ…‹:",e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full text-white ${r?"bg-green-500":"bg-red-500"}`,children:r?"å·²é€£ç·š":"æœªé€£ç·š"})]})]}),o&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsx(O,{variant:"h6",gutterBottom:!0,children:"å‚³é€æª”æ¡ˆ"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(L,{variant:"outlined",component:"label",disabled:!r,children:["é¸æ“‡æª”æ¡ˆ",e.jsx("input",{type:"file",hidden:!0,multiple:!0,onChange:b})]}),e.jsx(L,{variant:"contained",color:"primary",onClick:y,disabled:!r||!s.some(a=>a.status===S.SELECTED),sx:{ml:2},className:"ml-2",children:"å‚³é€å·²é¸æ“‡çš„"})]}),s.length>0&&e.jsx(X,{dense:!0,children:s.map(a=>e.jsxs(V,{divider:!0,className:"hover:bg-gray-50",children:[e.jsx("img",{src:a.previewUrl,alt:a.name,className:"w-12 h-12 object-cover mr-3 rounded"}),e.jsx(Y,{primary:e.jsx("span",{className:"font-medium",children:a.name}),secondary:`${(a.size/1024).toFixed(1)} KB - ç‹€æ…‹: ${a.status}`}),e.jsx("div",{className:"ml-auto",children:I(a.status,a.id)})]},a.id))})]}),!o&&e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs(O,{variant:"h6",gutterBottom:!0,component:"div",children:[" ","æ¥æ”¶åˆ°çš„æª”æ¡ˆ"]}),c.length>0&&e.jsx(L,{variant:"contained",size:"small",startIcon:e.jsx(Re,{}),onClick:A,disabled:!P||!r,className:"bg-teal-500 hover:bg-teal-700 disabled:bg-gray-300",children:"ä¸‹è¼‰å…¨éƒ¨æœªä¸‹è¼‰"})]}),c.length===0&&r&&e.jsx(O,{variant:"body2",color:"textSecondary",children:"ç­‰å¾…æ¥æ”¶æª”æ¡ˆä¸­..."}),c.length===0&&!r&&e.jsx(O,{variant:"body2",color:"textSecondary",children:"è«‹å…ˆé€£ç·šè‡³ Hostã€‚"}),c.length>0&&e.jsx(X,{dense:!0,children:c.map(a=>e.jsxs(V,{divider:!0,className:"hover:bg-gray-50",children:[e.jsx("img",{src:a.blobUrl,alt:a.name,className:"w-12 h-12 object-cover mr-3 rounded"}),e.jsx(Y,{primary:e.jsx("span",{className:"font-medium",children:a.name}),secondary:`${(a.size/1024).toFixed(1)} KB`}),e.jsx($,{title:"ä¸‹è¼‰æª”æ¡ˆ",children:e.jsx(W,{color:"primary",onClick:()=>D(a.id),disabled:a.status===S.DOWNLOADED,children:e.jsx(Be,{})})}),a.status===S.DOWNLOADED&&e.jsx($,{title:"å·²ä¸‹è¼‰",children:e.jsx(ee,{color:"success",className:"ml-2"})})]},a.id))})]})]})})})})}function _t(){const[t,o]=he(),n=t.get("roomId"),l=Q(),[r,d]=h.useState(""),{setSnackMsg:i}=G(),[s,u]=J(Ae);h.useEffect(()=>{const f=we().slice(0,13);o({roomId:f,isHost:!0});const x=window.location.origin;d(`${x}/SendImg/join/${f}`)},[]),h.useEffect(()=>{s&&l(`/transfer?roomId=${n}&isHost=true`)},[s]);const c=()=>{r&&navigator.clipboard.writeText(r).then(()=>{i({message:"å·²è¤‡è£½åŠ å…¥é€£çµåˆ°å‰ªè²¼ç°¿ï¼"})})},v=()=>{l("/")};return e.jsxs("div",{className:"min-h-screen bg-[#0D1117] text-[#C9D1D9] flex flex-col items-center justify-center px-4",children:[e.jsx("h2",{className:"text-2xl font-medium mb-6",children:"ğŸ†” ä½ çš„æˆ¿é–“ ID"}),e.jsxs("div",{className:"bg-[#161B22] p-6 rounded-lg flex flex-col items-center",children:[e.jsx("p",{className:"text-xl font-mono mb-4",children:n}),r&&e.jsxs("div",{className:"w-full mb-4",children:[e.jsx("label",{className:"block text-sm text-[#8B949E] mb-1",children:"åŠ å…¥é€£çµ"}),e.jsxs("div",{className:"flex items-center bg-[#0D1117] rounded-lg overflow-hidden",children:[e.jsx("input",{type:"text",readOnly:!0,value:r,className:"flex-1 px-3 py-2 bg-transparent text-[#C9D1D9] font-mono focus:outline-none"}),e.jsx("button",{onClick:c,className:"px-3 py-2 bg-[#238636] hover:bg-[#2EA043] text-white transition",children:"è¤‡è£½"})]})]}),r&&e.jsx("div",{className:"bg-white p-2 rounded-md mb-4",children:e.jsx(mt,{value:r,size:128})}),e.jsx("p",{className:"text-sm text-[#8B949E]",children:"ç­‰å¾…å°æ–¹æƒææˆ–é»é¸é€£çµåŠ å…¥â€¦â³"})]}),e.jsx("button",{className:"mt-8 bg-[#161B22] hover:bg-[#30363D] text-[#C9D1D9] px-6 py-2 rounded-lg transition",onClick:v,children:"â† è¿”å›"})]})}function ce(){const t=Q(),{roomId:o}=De(),[n,l]=h.useState("");h.useEffect(()=>{o&&t(`/transfer?roomId=${o}`)},[o,t]);const r=()=>{const i=n.trim();i.length!==0&&t(`/transfer?roomId=${i}`)},d=()=>{t("/")};return o?e.jsx("div",{className:"min-h-screen bg-[#0D1117] text-[#C9D1D9] flex items-center justify-center",children:e.jsx("p",{className:"text-lg",children:"è‡ªå‹•å°å‘ä¸­â€¦"})}):e.jsxs("div",{className:"min-h-screen bg-[#0D1117] text-[#C9D1D9] flex flex-col items-center justify-center px-4",children:[e.jsx("h2",{className:"text-2xl font-medium mb-6",children:"ğŸ”— åŠ å…¥æˆ¿é–“"}),e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("label",{className:"block text-[#8B949E] mb-2",htmlFor:"roomId",children:"æˆ¿é–“ ID"}),e.jsx("input",{id:"roomId",type:"text",value:n,onChange:i=>l(i.target.value),className:"w-full px-4 py-2 bg-[#161B22] text-[#C9D1D9] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#238636] mb-4",placeholder:"è¼¸å…¥æˆ¿é–“ ID..."}),e.jsx("button",{className:"w-full bg-[#238636] hover:bg-[#2EA043] text-white py-3 rounded-lg transition mb-4",onClick:r,children:"åŠ å…¥"}),e.jsx("button",{className:"w-full bg-[#161B22] hover:bg-[#30363D] text-[#C9D1D9] py-3 rounded-lg transition",onClick:d,children:"â† è¿”å›"})]})]})}function Gt(){var r;const{roomId:t}=De(),o=xt(),n=Q();(r=o.state)==null||r.isHost;const l=()=>{n("/")};return e.jsx("div",{className:"bg-[#0D1117] text-[#C9D1D9] flex flex-col items-center px-4 py-6",children:e.jsx("button",{className:"mt-auto bg-[#161B22] hover:bg-[#30363D] text-[#C9D1D9] px-6 py-2 rounded-lg transition",onClick:l,children:"â† é›¢é–‹æˆ¿é–“"})})}function Wt(){const[t,o]=he(),n=t.get("roomId"),l=t.get("isHost");return e.jsxs(F,{sx:{flex:"1 1 auto"},children:[e.jsx(Ht,{roomId:n,isHost:l}),e.jsxs(Ce,{children:[e.jsx(T,{path:"/",element:e.jsx(Kt,{})}),e.jsx(T,{path:"/create",element:e.jsx(_t,{})}),e.jsx(T,{path:"/join/:roomId",element:e.jsx(ce,{})}),e.jsx(T,{path:"/join",element:e.jsx(ce,{})}),e.jsx(T,{path:"/transfer",element:e.jsx(Gt,{})})]})]})}function Jt(t){const{title:o}=t;return e.jsx("footer",{children:e.jsx("div",{className:"footer-content footer-info flex aic",children:e.jsx("div",{className:"flex rowTitle",children:"SAF Kanban. WHL. All rights reserved."})})})}function Qt(){return H("(min-width:900px)"),e.jsx(F,{sx:{display:"flex",height:"100%",width:"100%"},children:e.jsxs(F,{component:"main",sx:{flexGrow:1,p:0,display:"flex",flexDirection:"column"},children:[e.jsx(Wt,{}),e.jsx(Jt,{title:null})]})})}function qt(){const{open:t,closeAlert:o,title:n,content:l,handleAgree:r,handleDisagree:d}=jt(i=>i);return e.jsxs(me,{open:t,onClose:o,children:[e.jsx(ge,{children:n}),e.jsx(xe,{children:e.jsx(He,{sx:{whiteSpace:"pre-line"},children:l})}),e.jsxs(pe,{children:[e.jsx(L,{onClick:o,children:"å–æ¶ˆ"}),e.jsx(L,{onClick:()=>r(o),autoFocus:!0,children:"ç¢ºèª"})]})]})}function Zt(t){var D;const{children:o,margin:n=15,sx:l={},content_sx:r={},data:d=null,onlyProps:i=!1,noDrawer:s=!1}=t,u=((D=Ct())==null?void 0:D.isDrawerOpen)&&!s,c=H(u?"(min-width:1440px)":"(min-width:1200px)"),v=H(u?"(min-width:1232px)":"(min-width:992px)"),f=H(u?"(min-width:1008px)":"(min-width:768px)");let x=c?"1170px":v?"970px":f?"750px":"100%",b=(d==null?void 0:d.length)<3?`${100/d.length}%`:c?1170/3:v?970/3:f?750/2:x;const y={content_width:x,margin:`${n}px`,width:b,width_margin:typeof b!="string"?b-n*2:`calc(${b} - ${n*2}px)`,lg:c,md:v,xs:f};return i==!0?e.jsx(h.Fragment,{children:h.cloneElement(o,{...y})}):e.jsx(F,{className:"flex flex-1-1 jcsb flex-col aic",sx:{...l},children:e.jsx(F,{sx:{width:x,display:"flex",flexWrap:"wrap",...r},children:h.cloneElement(o,{...y})})})}const Xt=_e(me)(({theme:t})=>({"& .MuiDialogContent-root":{padding:t.spacing(2)},"& .MuiDialogActions-root":{padding:t.spacing(1)}}));function Vt(t){const{isRwdWidth:o}=t;return o?e.jsx(Zt,{onlyProps:!0,noDrawer:!0,children:e.jsx(de,{...t})}):e.jsx(de,{...t})}const de=t=>{const{content_width:o,open:n,title:l,content:r,actions:d,body:i,closeDialog:s,disableScrollLock:u,fullWidth:c,fullHeight:v,maxWidth:f,fullScreen:x,isRwdWidth:b,contentProps:y={}}=t,D=b?{sx:{width:"100%",maxWidth:`${o} !important`,height:v?"100%":"auto"}}:{fullWidth:c,maxWidth:f,fullScreen:x};return e.jsxs(Xt,{onClose:s,open:n,disableScrollLock:!!u,...b?{}:D,PaperProps:{...b?D:{}},children:[e.jsxs(F,{className:"flex aic jcsb",sx:{p:1},children:[e.jsx(ge,{sx:{m:0,p:0,pl:1},children:l}),e.jsx(W,{onClick:s,sx:{color:A=>A.palette.grey[500]},children:e.jsx(Ge,{})})]}),i?h.cloneElement(i,{closeDialog:s}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{dividers:!0,sx:{...y},children:!!r&&h.cloneElement(r,{closeDialog:s})}),!!d&&e.jsx(pe,{children:h.cloneElement(d,{closeDialog:s})})]})]})},Yt=()=>{const{...t}=Dt();return e.jsxs(e.Fragment,{children:[e.jsx(Qt,{}),e.jsx(qt,{}),e.jsx(ht,{}),e.jsx(Vt,{...t})]})},en={},_=ye(en,async(t,o,n)=>{let l=t(_);o(_,{...l,...n})}),tn=()=>{const[{...t},o]=J(_),n=({key:l,body:r})=>{console.log(`apiDataAtom log (${l}):`,{...t,[l]:r}),o({[l]:r})};return{...gt(_),setApiData:n}},nn=()=>{const{setSnackMsg:t}=G(s=>s),{setApiData:o}=tn(),n=(s=[])=>{let u="";s==null||s.map((c,v)=>{u+=(v==0?"":`

`)+((c==null?void 0:c.displayName)||(c==null?void 0:c.field))+`ï¼š
`+(c==null?void 0:c.error)}),setAlert({title:"éŒ¯èª¤",content:u,handleAgree:c=>c()})},l=(s,u,c)=>{console.log("onError",s,u),t({message:"APIç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"})},r=async(s,u)=>{var v,f,x,b,y,D,A,P,N,I,a;((f=(v=u==null?void 0:u.queryKey)==null?void 0:v[0])==null?void 0:f[0])=="_"&&o({key:(b=(x=u==null?void 0:u.queryKey)==null?void 0:x[0])==null?void 0:b.replace("_",""),body:{data:s==null?void 0:s.body,refetch:(y=u==null?void 0:u.options)==null?void 0:y.queryFn}});const c=((D=s==null?void 0:s.body)==null?void 0:D.status)!==null&&((A=s==null?void 0:s.body)==null?void 0:A.status)!==void 0?(P=s==null?void 0:s.body)==null?void 0:P.status:null;c!==null&&Array.isArray((N=s==null?void 0:s.body)==null?void 0:N.errorArray)?n((I=s==null?void 0:s.body)==null?void 0:I.errorArray):c!==null&&t({message:(a=s==null?void 0:s.body)==null?void 0:a.message}),!(s!=null&&s.ok)&&c==null&&!(s!=null&&s.pages)&&t({message:"APIç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼"})},d=(s,u)=>{},i=new Qe({queryCache:new Ze({onSuccess:r,onError:l,onSettled:d}),mutationCache:new qe({onSuccess:r,onError:l}),defaultOptions:{queries:{refetchOnWindowFocus:!1,select:s=>{var v,f,x,b;let c=(((v=s==null?void 0:s.body)==null?void 0:v.status)!==null&&((f=s==null?void 0:s.body)==null?void 0:f.status)!==void 0?(x=s==null?void 0:s.body)==null?void 0:x.status:null)==null&&s.body||null;if(Array.isArray(s==null?void 0:s.pages)){let y=[];(b=s==null?void 0:s.pages)==null||b.map((D,A)=>{y[A]=(D==null?void 0:D.body)||D}),c={...s,pages:y}}return c}}}});return e.jsx(Xe,{client:i,children:e.jsx(We,{basename:"/SAF_Kanban/",children:e.jsx(Yt,{})})})},sn=document.getElementById("root");$e.createRoot(sn).render(e.jsx(nn,{}));
